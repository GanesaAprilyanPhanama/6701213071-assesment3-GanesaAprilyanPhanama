<!DOCTYPE html>
<html>
<head>
  <title>Product Listing</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
</head>
<body>
  <table id="productTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table><br>

  <form id="addProductForm" method="POST">
    <input type="text" name="name" placeholder="Product Name"><br>
    <input type="number" name="price" step="0.01" placeholder="Product Price"><br>
    <button type="submit">Add Product</button>
  </form>


  <script>
    $(document).ready(function() {
        var table;
        var table = $('#productTable').DataTable({
          ajax: '/products',
          columns: [
            { data: 'id' },
            { data: 'name' },
            { data: 'price' },
            {
            data: null,
            render: function(data, type, row) {
              return '<button onclick="editProduct(' + row.id + ')">Edit</button>' +
                '<button onclick="deleteProduct(' + row.id + ')">Delete</button>';
            }
          }
        ]
        });

      $('#addProductForm').submit(function(event) {
        event.preventDefault();

        var name = $('input[name="name"]').val();
        var price = $('input[name="price"]').val();

        $.ajax({
          type: 'POST',
          url: '/products/add',
          data: { name: name, price: price },
          success: function(response) {
            alert(response.message);
            // Clear the form fields
            $('input[name="name"]').val('');
            $('input[name="price"]').val('');

            // Refresh the DataTable to display the new product
            table.ajax.reload();
          },
          error: function(error) {
            alert('Please fill up the field.');
            console.error(error);
          }
        });
      });
    });

    function editProduct(id) {
          // Retrieve the current data of the row
          var rowData = table.row('#row-' + id).data();

          // Display a form or modal for editing the product
          var formHtml = '<input type="text" id="editName" value="' + rowData.name + '">';
          formHtml += '<input type="number" id="editPrice" step="0.01" value="' + rowData.price + '">';
          formHtml += '<button onclick="updateProduct(' + id + ')">Update</button>';

          // Replace the row data with the form
          table.row('#row-' + id).data(['', formHtml, '', '']).draw(false);
        }



    function deleteProduct(id) {
        if (confirm('Are you sure you want to delete this product?')) {
          $.ajax({
            type: 'DELETE',
            url: '/products/delete',
            data: { id: id },
            success: function(response) {
              alert(response.message);
              // Remove the row from the DataTable
              table.row('#row-' + id).remove().draw(false);
              DataTable.ajax.reload();
              table.ajax.reload();
            },
            error: function(error) {
              alert('An error occurred while deleting the product.');
              console.error(error);
            }
            
        });
        }
    }
  </script>
</body>
</html>
